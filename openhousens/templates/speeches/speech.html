{% load firstof url from future %}
{% load staticfiles speech_utils legislature_extras %}

{% if with_speaker %}
  {% if speech.speaker_display %}
    {% if speech.speaker.image %}
<div class="image">
  <a href="{% url 'legislature:speaker-view' speech.speaker.slug %}">
    <div class="avatar" style="background-image: url({{ speech.speaker.image }})"></div>
  </a>
</div>
    {% endif %}
<p class="from">
    {% if speech.speaker_id %}
  <a href="{% url 'legislature:speaker-view' speech.speaker.slug %}">{{ speech|speech_speaker }}</a>
      {% if speech.speaker.memberships.all %}
  <span class="swatch {{ speech.speaker|speaker_party_class }}"></span>
  <span class="memberships">{{ speech.speaker|speaker_description }}</span>
      {% endif %}
    {% else %}
  {{ speech|speech_speaker }}
    {% endif %}
</p>
  {% endif %}
{% elif with_context %}
<p class="context">
  {# @todo link to speech #}
  <span class="title">{% firstof speech.title|heading speech.section.title|heading %}</span>
  <span class="date">{{ speech.section.start_date|date:"F jS, Y" }}</span>
  {% if highlight %}
    {% if speech.speaker_display %}
  <span class="from">
      {% if speech.speaker_id %}
    <a href="{% url 'legislature:speaker-view' speech.speaker.slug %}">{{ speech|speech_speaker }}</a>
      {% else %}
    {{ speech|speech_speaker }}
      {% endif %}
  </span>
    {% endif %}
  {% endif %}
</p>
{% endif %}

<div class="speech">
{{ speech.text|bleach }}
</div>

{% if with_speaker %}
<div class="actions">
  <a href="#s{{ speech.id }}" class="link">
    <span class="glyphicon glyphicon-link"></span> Link
  </a>
  <a href="https://twitter.com/share?related=SpringtideCo%3Aopenhousens.ca&amp;url={{ request.build_absolute_uri|urlencode }}%23s{{speech.id}}&amp;text={{ speech|tweet_text }}&amp;via=SpringtideCo" class="twitter">
    <img src="{% static 'img/twitter.png' %}" width="20" height="16" alt=""> Tweet
  </a>
</div>
{% endif %}